<html>
<head>
<script type="text/javascript" src="public/jquery-2.0.3.min.js"></script>
<style>
.red {
  color: #ff0000;
}
.green {
  color: #00ff00;
}
.blue {
  color: #0000ff;
}
</style>
</head>
<body>

<div id="div0"></div>
<div class="red" id="div1"></div>
<div class="green" id="div2"></div>
<div class="blue" id="div3"></div>
<div class="percent" id="percentDiff-cpp"></div>
<div class="percent-opencl" id="percentDiff-opencl"></div>
<br>
<button id="btn">Perform POC</button>

<script>

  var jsElapsed = -1;
  var cppElapsed = -1;
  var openClElapsed = -1;
  
  var clearElapsed = function(){
    jsElapsed = -1;
    cppElapsed = -1;
    openClElapsed = -1;
    $('#percentDiff-cpp').html('');
    $('#percentDiff-opencl').html('');
  };

  var setElapsed = function(fName, elapsed){
    if (fName === 'js'){
      jsElapsed = elapsed;
    }
    if (fName === 'c++'){
      cppElapsed = elapsed;
    }
    if (fName === 'open-cl'){
      openClElapsed = elapsed;
    }
    if (jsElapsed > 0 && cppElapsed > 0) {
      var percentDiff = 100 - cppElapsed * 100 / jsElapsed;
      var roundedPercentDiff = Math.round(percentDiff);
      $('#percentDiff-cpp').html('C++ is ' + roundedPercentDiff + '% faster than JS');
    }
     if (jsElapsed > 0 && cppElapsed > 0 && openClElapsed > 0) {
      var percentDiffOpenCL = 100 - openClElapsed * 100 / cppElapsed;
      var roundedPercentDiffOpenCL = Math.round(percentDiffOpenCL);
      $('#percentDiff-opencl').html('OpenCL is ' + roundedPercentDiffOpenCL + '% faster than C++');
    }
 }

  var rndArr = function(arrSize, maxNum) {
    var arr = []; 
    for (var i=0; i<arrSize; ++i) {
      arr[i] = Math.floor((Math.random() * maxNum) + 1); 
    }   
    return arr;
  };

  var performPOC = function(url, outId, data) {
    $('#' + outId).html('loading...');
    $.ajax({
      url: url,
      data: data,
      dataType: 'json',
      type: 'POST'
    }).then(
        function( data, textStatus, jqXHR ) {
          var fName = data.fName;
          var elapsed = data.elapsed;
          var res = data.res;
          var html = fName + ' module time: ' 
            + elapsed + 'ms <br>result: ' 
            + res.join(', ');
          $('#' + outId).html(html);
          setElapsed(fName, elapsed);
        }, 
        function( jqXHR, textStatus, errorThrown ) {
          $('#' + outId).html('error');
        }
    );
  }

  $('#btn').click(function(){
    clearElapsed();
    var arrCommon = rndArr(10, 40);
    $('#div0').html('Calculate Nth Fibonacci # for each N in (' + arrCommon.join(", ") + ')');
    var data = {"arr": arrCommon};
    performPOC('http://localhost:5000/poc-js', 'div1', data);
    performPOC('http://localhost:4000/poc-cpp', 'div2', data);
    performPOC('http://localhost:4040/poc-open-cl', 'div3', data);
  });
</script>


</body>
</html>
